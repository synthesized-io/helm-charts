mode: self-hosted
sandbox: true
# Enables OpenShift-friendly mounts for nginx; auto-detected in templates via route.openshift.io.
openShiftEnabled: true

# Envoy sidecar configuration for mTLS
envoy:
  enabled: true
  image:
    repository: envoyproxy/envoy
    tag: v1.36.4
    pullPolicy: IfNotPresent
  resources: {}
  # Certificate configuration
  certificates:
    # ClusterIssuer name for cert-manager
    clusterIssuer: "internal-ca-issuer"
    # Duration of certificates
    duration: 8760h  # 1 year
    # Renew before expiry
    renewBefore: 720h  # 30 days
  # Port mappings for Envoy listeners
  ports:
    # Envoy admin port (for health checks)
    admin: 9901
    # Secure listener ports (external facing)
    secureHttp: 8443
    secureGrpc: 50443
  # Log level for Envoy
  logLevel: info

imagePullSecrets:
  - name: dockerhub-creds

api:
  name: governor-api
  group: governor-api
  image:
    repository: synthesizedio/synthesized-api
    pullPolicy: Always
  # securityContext:
  #   runAsNonRoot: true
  #   runAsUser: null
  #   fsGroup: 1000660000
  #   fsGroupChangePolicy: "OnRootMismatch"
  #   seccompProfile:
  #     type: RuntimeDefault
  securityContext: null
  container:
    port: 8081
    grpcPort: 50055
    config:
      SPRING_PROFILES_ACTIVE: production
      VERSION: 'not-specified'
    # Sensitive configuration variables that will be rendered as a new secret
    secretConfig:
      SPRING_DATASOURCE_URL: "jdbc:postgresql://governor-postgresql:5432/governor"
      SPRING_DATASOURCE_USERNAME: "governor"
      SPRING_DATASOURCE_PASSWORD: "governor"
      JWT_SECRET: "75gCe94oOW4CPsuHhfRY2m62ylf73mJxmMyZCFifNQKewULlp2/LeAXWpDht35tKKLp8gEaMZ9l10OolJe+QFYcq+9sJfH3yFc6/wwmrk4QAuiCX2gPMIvyOHRlYVLQoTZ87miJBtyqIQbFQ9CRGrS0l13F+XGbEF1q83dOzEp1yS+L9b6TAEOGDgSP3sLBcr1fK3+Qfto2Nv+Qd3DdJtqXcqlYSm1B8aafWl+YValM2Rj/tgs7DrBdWFnQpowE4gV+kdbYOpFIIn93unnDGG5JvFc95hKDPTBLighaerLVPVSMqcLnb9v0Xn81MOw5qNZsihNsXIHCNZu2VI6DxyA=="
      ADMIN_EMAIL: "yuri@synthesized.io"
      ADMIN_DEFAULT_PASSWORD: "aaa1111@#%@ASd"
  persistence:
    enabled: false
    name: api-pv
    mountPath: /data
    claimName: api-pvc
    size: 10Gi
  service:
    type: ClusterIP
    port: 80
    grpcPort: 50055

front:
  name: governor-front
  group: governor-front
  image:
    repository: synthesizedio/synthesized-front
    pullPolicy: Always
  # securityContext:
  #   runAsNonRoot: true
  #   runAsUser: null
  #   fsGroup: 1000660000
  #   fsGroupChangePolicy: "OnRootMismatch"
  securityContext: null
  container:
    port: 8080
    config:
      # private hosts
      API_INTERNAL_HOST: 'governor-api'
      API_GRPC_INTERNAL_PORT: '50055'
      API_HTTP_INTERNAL_PORT: '80'
      UI_TDK_AGENTS: "true"
      UI_TDK_AGENTS_BY_DEFAULT: "true"
      UI_PII_SCAN: "true"
      UI_WORKFLOW_WIZARD: "true"
    secretConfig:
      POSTHOG_ANALYTICS_API_KEY: ""
  service:
    type: ClusterIP
    port: 80

agent:
  name: governor-agent
  group: governor-director
  image:
    repository: synthesizedio/synthesized-agent
    pullPolicy: Always
  # securityContext:
  #   runAsNonRoot: true
  #   runAsUser: null
  #   fsGroup: 1000660000
  #   fsGroupChangePolicy: "OnRootMismatch"
  securityContext: null
  container:
    config:
      AGENT_WORKING_DIRECTORY_PATH: '/app/rocksdb'
      AGENT_SERVERHOST: 'governor-api'
      AGENT_SERVERPORT: '50055'
      AGENT_TAGS: 'default'
      AGENT_DATASOURCES: '*'
      AGENT_USEPLAINTEXT: "true"
      AGENT_CONNECTIONS_POOL_SIZE: '20'
  persistence:
    enabled: false
    name: agent-pv
    mountPath: /app/rocksdb
    claimName: agent-pvc
    size: 10Gi

postgresql:
  enabled: true
  name: governor-postgresql
  image:
    repository: postgres
    tag: "17"
    pullPolicy: IfNotPresent
  securityContext: null
  port: 5432
  database: governor
  username: governor
  password: governor
  persistence:
    enabled: true
    size: 10Gi
    claimName: postgresql-pvc
  resources: {}

nodeSelector: {}

tolerations: []

affinity: {}

ingress:
  enabled: false
  annotations:
    kubernetes.io/ingress.class: webapprouting.kubernetes.azure.com
    cert-manager.io/cluster-issuer: "letsencrypt-staging"
    kubernetes.io/tls-acme: "true"
  hosts:
    - host: example.synthesized.io
      paths:
        - path: /
          service: governor-front
          servicePort: 80
        - path: /api
          service: governor-api
          servicePort: 8081
  tls:
    - secretName: tls-secret
      hosts:
        - example.synthesized.io

grpcIngress:
  enabled: false
  annotations:
    nginx.ingress.kubernetes.io/backend-protocol: "GRPC"
    kubernetes.io/ingress.class: webapprouting.kubernetes.azure.com
    cert-manager.io/cluster-issuer: "letsencrypt-staging"
    kubernetes.io/tls-acme: "true"
  hosts:
    - host: grpc.example.synthesized.io
      paths:
        - path: /api
          service: governor-api
          servicePort: 50055
  tls:
    - secretName: grpc-tls-secret
      hosts:
        - grpc.example.synthesized.io
